    def buscar_en_internet(self, consulta):
        """Búsqueda web profesional usando DuckDuckGo API con resumen inteligente"""
        try:
            query = urllib.parse.quote(f"{consulta}")
            url = f"https://api.duckduckgo.com/?q={query}&format=json&no_html=1&skip_disambig=1"
            
            req = urllib.request.Request(url, headers={
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
            })
            
            with urllib.request.urlopen(req, timeout=10) as response:
                data = json.loads(response.read().decode())
                
                # Procesar respuesta Abstract
                abstract = data.get('Abstract', '')
                if abstract and len(abstract) > 20:
                    fuente = data.get('AbstractSource', 'Internet')
                    url_fuente = data.get('AbstractURL', '')
                    
                    # RESUMEN INTELIGENTE con traducción
                    respuesta = f"{self.t('resumen')} {consulta.upper()}**\n\n"
                    respuesta += f"{abstract}\n\n"
                    respuesta += f"{self.t('fuente')} {fuente}"
                    if url_fuente:
                        respuesta += f"\n{self.t('mas_detalles')} {url_fuente}"
                    
                    return respuesta
                
                # Intentar con temas relacionados
                related = data.get('RelatedTopics', [])
                if related:
                    # Recopilar información
                    informacion = []
                    for topic in related[:6]:
                        if isinstance(topic, dict):
                            if 'Text' in topic:
                                texto = topic['Text']
                                if len(texto) > 15:
                                    informacion.append(texto)
                            elif 'Topics' in topic:
                                for subtopic in topic['Topics'][:3]:
                                    if 'Text' in subtopic:
                                        texto = subtopic['Text']
                                        if len(texto) > 15:
                                            informacion.append(texto)
                    
                    if informacion:
                        # Crear resumen inteligente con traducción
                        respuesta = f"{self.t('encontre')} {consulta.upper()}**\n\n"
                        respuesta += f"{self.t('basandome')}\n\n"
                        
                        # Mostrar los puntos más importantes
                        for i, info in enumerate(informacion[:4], 1):
                            respuesta += f"{i}. {info}\n\n"
                        
                        respuesta += self.t('resumen_generado')
                        return respuesta
                
                # Si no hay resultados útiles
                return f"{self.t('busque')} {consulta}**\n\n{self.t('no_encontre')}\n\n{self.t('intenta')}\n• Reformular la pregunta\n• Usar términos más específicos\n• Preguntar sobre otro tema"
                
        except urllib.error.URLError:
            return f"{self.t('sin_internet')}\n\n{self.t('preguntame')}"
        except Exception as e:
            print(f"Error búsqueda web: {e}")
            return f"{self.t('error_busqueda')}\n\n{self.t('preguntame')}"
    
    def calcular_matematicas(self, texto):
        """Realiza cálculos matemáticos avanzados - Modo Pitágoras"""
        texto_lower = texto.lower()
        
        try:
            # Detectar operaciones matemáticas
            # Suma, resta, multiplicación, división básicas
            if any(op in texto for op in ['+', '-', '*', '/', 'x', '÷']):
                # Limpiar y preparar la expresión
                expresion = texto
                expresion = expresion.replace('x', '*').replace('÷', '/')
                expresion = expresion.replace('por', '*').replace('entre', '/')
                expresion = expresion.replace('más', '+').replace('menos', '-')
                
                # Extraer solo números y operadores
                expresion_limpia = re.sub(r'[^0-9+\-*/().\s]', '', expresion)
                
                if expresion_limpia:
                    resultado = eval(expresion_limpia)
                    return f"🔢 **CÁLCULO MATEMÁTICO**\n\n📝 Operación: {expresion_limpia}\n✅ Resultado: **{resultado}**\n\n🧮 Calculado por Claudia (Modo Pitágoras)"
            
            # Raíz cuadrada
            if 'raiz cuadrada' in texto_lower or 'raíz cuadrada' in texto_lower or 'sqrt' in texto_lower:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if numeros:
                    num = float(numeros[0])
                    resultado = math.sqrt(num)
                    return f"🔢 **RAÍZ CUADRADA**\n\n√{num} = **{resultado:.4f}**\n\n📐 Calculado por Pitágoras (Claudia AI)"
            
            # Potencia
            if 'al cuadrado' in texto_lower or '²' in texto or '^2' in texto:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if numeros:
                    num = float(numeros[0])
                    resultado = num ** 2
                    return f"🔢 **POTENCIA**\n\n{num}² = **{resultado}**\n\n⚡ Calculado por Claudia AI"
            
            if 'al cubo' in texto_lower or '³' in texto or '^3' in texto:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if numeros:
                    num = float(numeros[0])
                    resultado = num ** 3
                    return f"🔢 **POTENCIA**\n\n{num}³ = **{resultado}**\n\n⚡ Calculado por Claudia AI"
            
            if 'elevado a' in texto_lower or 'potencia' in texto_lower or '^' in texto:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if len(numeros) >= 2:
                    base = float(numeros[0])
                    exponente = float(numeros[1])
                    resultado = base ** exponente
                    return f"🔢 **POTENCIA**\n\n{base}^{exponente} = **{resultado}**\n\n⚡ Calculado por Claudia AI"
            
            # Porcentaje
            if '%' in texto or 'por ciento' in texto_lower or 'porciento' in texto_lower:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if len(numeros) >= 2:
                    total = float(numeros[0])
                    porcentaje = float(numeros[1])
                    resultado = (total * porcentaje) / 100
                    return f"🔢 **CÁLCULO DE PORCENTAJE**\n\n{porcentaje}% de {total} = **{resultado}**\n\n📊 Calculado por Claudia AI"
            
            # Área del círculo
            if 'area' in texto_lower and 'circulo' in texto_lower or 'área' in texto_lower and 'círculo' in texto_lower:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if numeros:
                    radio = float(numeros[0])
                    area = math.pi * (radio ** 2)
                    return f"🔢 **ÁREA DEL CÍRCULO**\n\n📐 Radio: {radio}\n⭕ Área = π × r² = **{area:.4f}**\n\n🧮 Fórmula de Pitágoras aplicada"
            
            # Teorema de Pitágoras
            if 'pitagoras' in texto_lower or 'pitágoras' in texto_lower or 'hipotenusa' in texto_lower:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if len(numeros) >= 2:
                    a = float(numeros[0])
                    b = float(numeros[1])
                    c = math.sqrt(a**2 + b**2)
                    return f"📐 **TEOREMA DE PITÁGORAS**\n\n🔺 Catetos: a = {a}, b = {b}\n📏 Hipotenusa: c = √(a² + b²)\n✅ c = √({a}² + {b}²) = **{c:.4f}**\n\n🎓 Teorema aplicado correctamente"
            
            # Promedio
            if 'promedio' in texto_lower or 'media' in texto_lower and 'de' in texto_lower:
                numeros = re.findall(r'\d+\.?\d*', texto)
                if len(numeros) >= 2:
                    promedio = sum(float(n) for n in numeros) / len(numeros)
                    return f"🔢 **PROMEDIO**\n\n📊 Números: {', '.join(numeros)}\n➗ Promedio = **{promedio:.4f}**\n\n📈 Calculado por Claudia AI"
            
            # Factorial
            if 'factorial' in texto_lower:
                numeros = re.findall(r'\d+', texto)
                if numeros:
                    num = int(numeros[0])
                    if num <= 20:  # Límite para evitar números muy grandes
                        resultado = math.factorial(num)
                        return f"🔢 **FACTORIAL**\n\n{num}! = **{resultado}**\n\n🔢 Calculado por Claudia AI"
                    else:
                        return f"⚠️ El número es muy grande. Máximo: 20!"
            
            return None  # No es una operación matemática
            
        except Exception as e:
            return f"⚠️ **Error en cálculo**\n\nNo pude procesar la operación. Asegúrate de escribir correctamente.\n\nEjemplo: '5 + 3', 'raíz cuadrada de 16', '10% de 200'"
    
    def buscar_en_base_datos(self, texto):
        """Búsqueda inteligente en base de conocimientos universal"""
        texto_lower = texto.lower()
        
        # ========== TECNOLOGÍA ==========
        if any(palabra in texto_lower for palabra in ['inteligencia artificial', 'ia', 'chatgpt', 'ai', 'gpt']):
            return f"🤖 **INTELIGENCIA ARTIFICIAL**\n\n{self.base_conocimientos['tecnologia']['ia']}\n\n💡 La IA está transformando TODAS las industrias: medicina, educación, arte, programación.\n\n🔥 Empresas líderes: OpenAI (ChatGPT), Google (Gemini), Anthropic (Claude)"
        
        if 'python' in texto_lower or 'javascript' in texto_lower or 'programacion' in texto_lower or 'programar' in texto_lower:
            lenguajes = ', '.join(self.base_conocimientos['tecnologia']['programacion']['lenguajes_populares'])
            frameworks = ', '.join(self.base_conocimientos['tecnologia']['programacion']['frameworks'])
            return f"👨‍💻 **PROGRAMACIÓN**\n\n🔥 Lenguajes populares 2025:\n{lenguajes}\n\n⚡ Frameworks trending:\n{frameworks}\n\n📊 {self.base_conocimientos['tecnologia']['programacion']['info']}"
        
        if 'apple' in texto_lower or 'iphone' in texto_lower:
            return f"🍎 **APPLE**\n\n{self.base_conocimientos['tecnologia']['empresas']['apple']}\n\n💰 Empresa más valiosa del mundo\n📱 Ecosistema: iPhone, Mac, iPad, Apple Watch"
        
        if 'microsoft' in texto_lower:
            return f"💼 **MICROSOFT**\n\n{self.base_conocimientos['tecnologia']['empresas']['microsoft']}\n\n🎯 Windows, Office, Azure, Xbox\n🤖 Inversión masiva en OpenAI"
        
        if 'google' in texto_lower:
            return f"🔍 **GOOGLE**\n\n{self.base_conocimientos['tecnologia']['empresas']['google']}\n\n🌐 Buscador #1 mundial\n📱 Android en 70% de smartphones\n☁️ Google Cloud compitiendo con AWS"
        
        if 'meta' in texto_lower or 'facebook' in texto_lower or 'instagram' in texto_lower:
            return f"👤 **META (Facebook)**\n\n{self.base_conocimientos['tecnologia']['empresas']['meta']}\n\n📱 Apps: Facebook, Instagram, WhatsApp\n🥽 Reality Labs: Quest VR headsets"
        
        if 'openai' in texto_lower:
            return f"🧠 **OPENAI**\n\n{self.base_conocimientos['tecnologia']['empresas']['openai']}\n\n⚡ Fundada por Sam Altman, Elon Musk (salió)\n🎨 DALL-E para generar imágenes\n💬 ChatGPT revolucionó la IA"
        
        # ========== CIENCIA ==========
        if 'nasa' in texto_lower or 'artemis' in texto_lower:
            return f"🚀 **NASA**\n\n{self.base_conocimientos['ciencia']['espacio']['nasa']}\n\n🌙 Programa Artemis: Devolver humanos a la Luna\n🔴 Colaboración con SpaceX para Marte\n🛰️ Telescopio James Webb revolucionando astronomía"
        
        if 'spacex' in texto_lower or 'elon musk' in texto_lower or 'starship' in texto_lower:
            return f"🚀 **SPACEX**\n\n{self.base_conocimientos['ciencia']['espacio']['spacex']}\n\n👨‍🚀 CEO: Elon Musk\n🎯 Objetivo: Hacer a la humanidad multiplanetaria\n♻️ Cohetes Falcon 9 reutilizables abaratando costos"
        
        if 'telescopio' in texto_lower or 'james webb' in texto_lower or 'jwst' in texto_lower:
            return f"🔭 **TELESCOPIO JAMES WEBB**\n\n{self.base_conocimientos['ciencia']['espacio']['jwst']}\n\n🌌 Lanzado en 2021, activo desde 2022\n🔬 Ve luz infrarroja de galaxias a 13 mil millones años luz\n🪐 Descubriendo exoplanetas con posible vida"
        
        if 'medicina' in texto_lower or 'salud' in texto_lower or 'cancer' in texto_lower:
            return f"⚕️ **MEDICINA MODERNA**\n\n{self.base_conocimientos['ciencia']['medicina']}\n\n🧬 Edición genética CRISPR curando enfermedades\n💉 Vacunas ARNm (como COVID) revolucionarias\n🤖 IA diagnosticando mejor que doctores en algunos casos"
        
        # ========== ENTRETENIMIENTO ==========
        if 'marvel' in texto_lower or 'avengers' in texto_lower or 'mcu' in texto_lower:
            return f"🦸 **MARVEL / MCU**\n\n{self.base_conocimientos['entretenimiento']['peliculas']['marvel']}\n\n🎬 Universo cinematográfico más exitoso ($30 mil millones)\n⚡ Próximos: Fantastic Four, nuevos Avengers\n🔥 Fases 5 y 6 en desarrollo"
        
        if 'dc' in texto_lower or 'batman' in texto_lower or 'superman' in texto_lower:
            return f"🦇 **DC COMICS**\n\n{self.base_conocimientos['entretenimiento']['peliculas']['dc']}\n\n🎬 Universo reiniciado por James Gunn\n💪 Superman (2025) con David Corenswet\n🦇 Batman sigue siendo icónico"
        
        if 'taylor swift' in texto_lower:
            artistas = ', '.join(self.base_conocimientos['entretenimiento']['musica']['artistas'][:5])
            return f"🎵 **TAYLOR SWIFT**\n\n👑 Artista más grande del mundo actualmente\n🎸 Gira 'Eras Tour' récord histórico ($2 mil millones)\n🏆 12 Grammy Awards\n📀 Álbumes: Midnights, Folklore, 1989\n\n🌟 Otros artistas top: {artistas}"
        
        if 'musica' in texto_lower or 'cancion' in texto_lower:
            artistas = ', '.join(self.base_conocimientos['entretenimiento']['musica']['artistas'])
            return f"🎵 **MÚSICA 2025**\n\n🌟 Artistas más populares:\n{artistas}\n\n📊 {self.base_conocimientos['entretenimiento']['musica']['tendencias']}"
        
        if any(palabra in texto_lower for palabra in ['videojuego', 'gta', 'minecraft', 'fortnite', 'juegos']):
            juegos = ', '.join(self.base_conocimientos['entretenimiento']['videojuegos']['populares'])
            return f"🎮 **VIDEOJUEGOS 2025**\n\n🔥 Más populares:\n{juegos}\n\n🎯 {self.base_conocimientos['entretenimiento']['videojuegos']['consolas']}"
        
        # ========== GEOGRAFÍA ==========
        # Ciudades de México
        if 'monterrey' in texto_lower:
            return f"🇲🇽 **MONTERREY**\n\n📍 Capital de Nuevo León, México\n👥 5.3 millones habitantes (área metropolitana)\n🏔️ Cerro de la Silla (símbolo icónico)\n💼 Centro industrial y financiero más importante del norte de México\n🏈 Hogar de Rayados (Monterrey) y Tigres UANL\n🌆 'La Sultana del Norte' - Ciudad moderna y próspera"
        
        if 'ciudad de mexico' in texto_lower or 'cdmx' in texto_lower or ('mexico' in texto_lower and 'capital' in texto_lower):
            return f"🇲🇽 **CIUDAD DE MÉXICO (CDMX)**\n\n📍 Capital de México\n👥 9+ millones habitantes (21M en zona metropolitana)\n🏛️ Centro histórico Patrimonio de la Humanidad\n🎨 Museos: Antropología, Frida Kahlo, Bellas Artes\n🌮 Capital gastronómica de México\n🏙️ Una de las ciudades más grandes del mundo"
        
        if 'guadalajara' in texto_lower:
            return f"🇲🇽 **GUADALAJARA**\n\n📍 Capital de Jalisco, México\n👥 5+ millones habitantes\n🎵 Cuna del mariachi y tequila\n⚽ Hogar de Chivas (Guadalajara)\n🎨 'La Perla de Occidente'\n💻 Silicon Valley mexicano"
        
        if 'cancun' in texto_lower or 'cancún' in texto_lower:
            return f"🇲🇽 **CANCÚN**\n\n📍 Quintana Roo, México\n🏖️ Destino turístico #1 de México\n🌊 Playas paradisíacas del Caribe\n🏛️ Cerca de Chichén Itzá (Maravilla del Mundo)\n🐠 Snorkel en arrecifes de coral\n✈️ Más de 10 millones de turistas al año"
        
        # Países y capitales
        if 'capital' in texto_lower and ('francia' in texto_lower or 'paris' in texto_lower):
            return f"🇫🇷 **FRANCIA**\n\n🏛️ Capital: París\n👥 67 millones habitantes\n🗼 Torre Eiffel, Louvre, Notre-Dame\n🥖 Famosa por: gastronomía, moda, arte\n🏆 País más visitado del mundo"
        
        if 'paris' in texto_lower or 'parís' in texto_lower:
            return f"🇫🇷 **PARÍS**\n\n🗼 'La Ciudad de la Luz'\n🏛️ Torre Eiffel, Louvre, Arco del Triunfo\n🎨 Capital mundial del arte y la moda\n🥐 Croissants, café, haute cuisine\n💑 Ciudad más romántica del mundo"
        
        if 'capital' in texto_lower and 'españa' in texto_lower:
            return f"🇪🇸 **ESPAÑA**\n\n🏛️ Capital: Madrid\n👥 47 millones habitantes\n⚽ Real Madrid y Barcelona (mejores equipos del mundo)\n🎨 Famosa por: arte, playa, gastronomía, flamenco"
        
        if 'madrid' in texto_lower and 'ciudad' in texto_lower:
            return f"🇪🇸 **MADRID**\n\n🏛️ Capital de España\n👥 3.3 millones habitantes\n🎨 Museo del Prado, Reina Sofía\n⚽ Real Madrid (Santiago Bernabéu)\n🌳 Retiro, Gran Vía, Puerta del Sol\n🍷 Tapas, jamón ibérico, vida nocturna"
        
        if 'barcelona' in texto_lower and 'ciudad' in texto_lower:
            return f"🇪🇸 **BARCELONA**\n\n📍 Capital de Cataluña\n👥 1.6 millones habitantes\n🏛️ Sagrada Familia (Gaudí)\n🏖️ Playas mediterráneas\n⚽ FC Barcelona (Camp Nou)\n🎨 Arte, arquitectura modernista"
        
        if 'rusia' in texto_lower:
            return f"🇷🇺 **RUSIA**\n\n{self.base_conocimientos['geografia']['paises_grandes']['rusia']}\n👥 146 millones habitantes\n🏛️ Plaza Roja, Kremlin\n❄️ Clima muy frío en invierno"
        
        if 'canada' in texto_lower or 'canadá' in texto_lower:
            return f"🇨🇦 **CANADÁ**\n\n{self.base_conocimientos['geografia']['paises_grandes']['canada']}\n🍁 Símbolo: Hoja de arce\n🏒 Deporte nacional: Hockey sobre hielo\n🌲 Naturaleza increíble: Montañas Rocosas"
        
        if 'china' in texto_lower:
            return f"🇨🇳 **CHINA**\n\n{self.base_conocimientos['geografia']['paises_grandes']['china']}\n🏯 Gran Muralla China\n🐉 Cultura milenaria (5000+ años)\n💼 2da economía mundial"
        
        if 'estados unidos' in texto_lower or 'usa' in texto_lower or 'eeuu' in texto_lower:
            return f"🇺🇸 **ESTADOS UNIDOS**\n\n{self.base_conocimientos['geografia']['paises_grandes']['usa']}\n🗽 Estatua de la Libertad en Nueva York\n🎬 Hollywood - Capital mundial del cine\n💰 Economía #1 del mundo"
        
        if 'nueva york' in texto_lower or 'new york' in texto_lower:
            return f"🇺🇸 **NUEVA YORK**\n\n🗽 'La Gran Manzana'\n👥 8+ millones habitantes\n🏙️ Manhattan, Brooklyn, Queens\n🎭 Broadway, Times Square\n💼 Wall Street (centro financiero)\n🗼 Empire State, Central Park"
        
        if 'tokio' in texto_lower or 'tokyo' in texto_lower:
            return f"🇯🇵 **TOKIO**\n\n📍 Capital de Japón\n👥 14 millones habitantes (38M área metropolitana)\n🏙️ Ciudad más grande del mundo\n🗼 Tokyo Tower, Skytree\n🍣 Sushi, ramen, cultura pop\n🤖 Tecnología y tradición juntas"
        
        if 'londres' in texto_lower or 'london' in texto_lower:
            return f"🇬🇧 **LONDRES**\n\n📍 Capital del Reino Unido\n👥 9 millones habitantes\n🏰 Big Ben, Tower Bridge, Buckingham Palace\n🎭 Teatro, museos de clase mundial\n⚽ Arsenal, Chelsea, Tottenham\n☕ Cultura del té británico"
        
        # México como país
        if 'mexico' in texto_lower and not 'ciudad' in texto_lower:
            return f"🇲🇽 **MÉXICO**\n\n📍 País de América del Norte\n👥 128 millones habitantes\n🏛️ Civilizaciones antiguas: Aztecas, Mayas\n🌮 Tacos, mariachi, tequila\n🏖️ Playas: Cancún, Playa del Carmen\n🎨 Frida Kahlo, Diego Rivera\n⚽ Selección Mexicana muy apasionada"
        
        # ========== DEPORTES (mantener código anterior) ==========
        if any(palabra in texto_lower for palabra in ['la liga', 'liga española', 'liga', 'españa futbol']):
            return f"⚽ **LA LIGA ESPAÑOLA 2024-25**\n\n🏆 Líder: {self.base_conocimientos['deportes']['futbol']['la_liga']['lider']}\n🥈 Subcampeón: {self.base_conocimientos['deportes']['futbol']['la_liga']['subcampeon']}\n⚽ Goleadores: {', '.join(self.base_conocimientos['deportes']['futbol']['la_liga']['goleadores'])}\n\n📊 {self.base_conocimientos['deportes']['futbol']['la_liga']['info']}"
        
        # Premier League
        if 'premier' in texto_lower or 'inglaterra' in texto_lower:
            equipos = ', '.join(self.base_conocimientos['deportes']['futbol']['premier']['top3'])
            return f"⚽ **PREMIER LEAGUE 2024-25**\n\n🏆 Top 3: {equipos}\n\n📊 {self.base_conocimientos['deportes']['futbol']['premier']['info']}"
        
        # Champions League
        if 'champions' in texto_lower:
            favoritos = ', '.join(self.base_conocimientos['deportes']['futbol']['champions']['favoritos'])
            return f"⚽ **UEFA CHAMPIONS LEAGUE 2024-25**\n\n🏆 Favoritos: {favoritos}\n\n📊 {self.base_conocimientos['deportes']['futbol']['champions']['info']}\n\n🔥 ¡La competición más prestigiosa de Europa!"
        
        # Fútbol - equipos específicos
        if 'real madrid' in texto_lower or ('madrid' in texto_lower and 'real' in texto_lower):
            return f"⚽ **REAL MADRID**\n\n🏆 {self.base_conocimientos['deportes']['futbol']['la_liga']['lider']}\n📈 Racha: Excelente forma\n⭐ Figuras: Bellingham, Vinícius Jr., Rodrygo\n🎯 Objetivos: La Liga y Champions League\n\n👑 El club más laureado de Europa"
        
        if 'barcelona' in texto_lower or 'barça' in texto_lower or 'barca' in texto_lower:
            return f"⚽ **FC BARCELONA**\n\n🥈 {self.base_conocimientos['deportes']['futbol']['la_liga']['subcampeon']}\n⭐ Goleador: Robert Lewandowski\n💎 Jóvenes: Gavi, Pedri, Fermín\n📊 Proyecto: Xavi construyendo equipo competitivo\n\n🔵🔴 Más que un club"
        
        if 'arsenal' in texto_lower:
            return f"⚽ **ARSENAL FC**\n\n🏆 Líder de la Premier League\n⭐ Jugadores clave: Saka, Ødegaard, Rice\n📊 Forma: Excelente momento bajo Arteta\n🎯 Objetivo: Ganar la Premier después de 20 años"
        
        if 'city' in texto_lower or 'manchester city' in texto_lower:
            return f"⚽ **MANCHESTER CITY**\n\n🏆 Peleando el liderato de Premier\n⭐ Estrella: Erling Haaland (máximo goleador)\n📊 Guardiola buscando más títulos\n🏆 Campeones de Europa 2023"
        
        # Jugadores específicos
        if 'messi' in texto_lower:
            return f"⚽ **LIONEL MESSI**\n\n{self.base_conocimientos['deportes']['futbol']['jugadores']['messi']}\n🏆 8 Balones de Oro (récord)\n⚽ Campeón del Mundo 2022 con Argentina 🇦🇷\n📍 Actualmente brillando en la MLS\n👑 Considerado el mejor de la historia"
        
        if 'ronaldo' in texto_lower and 'cristiano' in texto_lower or texto_lower.strip() == 'ronaldo':
            return f"⚽ **CRISTIANO RONALDO**\n\n{self.base_conocimientos['deportes']['futbol']['jugadores']['ronaldo']}\n🏆 5 Balones de Oro\n⚽ Máximo goleador histórico del fútbol (más de 890 goles)\n👑 Leyenda del Real Madrid y Manchester United\n💪 Sigue activo a los 39 años"
        
        if 'haaland' in texto_lower:
            return f"⚽ **ERLING HAALAND**\n\n{self.base_conocimientos['deportes']['futbol']['jugadores']['haaland']}\n⚽ Máximo goleador Premier League 2023-24\n💪 Récord: 36 goles en una temporada\n🇳🇴 Noruega - 24 años\n🚀 Considerado el futuro del fútbol"
        
        if 'mbappe' in texto_lower or 'mbappé' in texto_lower:
            return f"⚽ **KYLIAN MBAPPÉ**\n\n{self.base_conocimientos['deportes']['futbol']['jugadores']['mbappe']}\n⚡ Velocidad increíble y técnica superior\n🇫🇷 Campeón del Mundo 2018\n🔜 Próximo fichaje estrella del Real Madrid\n⭐ Solo 25 años"
        
        # NBA
        if 'lakers' in texto_lower:
            return f"🏀 **LOS ANGELES LAKERS**\n\n📊 Récord: 13-5 (Temporada 2024-25)\n⭐ Estrellas: LeBron James (39 años) y Anthony Davis\n🎯 Forma: Excelente momento\n🏆 17 campeonatos en su historia\n💜💛 Uno de los equipos más icónicos de la NBA"
        
        if 'lebron' in texto_lower:
            return f"🏀 **LEBRON JAMES**\n\n👑 'King James' - Los Angeles Lakers\n📊 39 años, todavía dominante\n🏆 4 campeonatos NBA\n⭐ Jugando con su hijo Bronny (histórico)\n📈 Máximo anotador de todos los tiempos NBA"
        
        if 'celtics' in texto_lower:
            return f"🏀 **BOSTON CELTICS**\n\n📊 Récord: 15-3 (Mejor del Este)\n⭐ Jayson Tatum, Jaylen Brown\n🏆 18 campeonatos (récord NBA)\n💚 Dinastía histórica del baloncesto"
        
        if 'nba' in texto_lower:
            este = '\n'.join([f"  • {e}" for e in self.datos_deportivos['baloncesto']['nba']['este'][:3]])
            oeste = '\n'.join([f"  • {e}" for e in self.datos_deportivos['baloncesto']['nba']['oeste'][:3]])
            return f"🏀 **NBA TEMPORADA 2024-25**\n\n🔷 CONFERENCIA ESTE:\n{este}\n\n🔶 CONFERENCIA OESTE:\n{oeste}\n\n⭐ Favoritos: Celtics, Nuggets, Lakers"
        
        # Tenis
        if 'tenis' in texto_lower or 'alcaraz' in texto_lower or 'djokovic' in texto_lower:
            return f"🎾 **TENIS MUNDIAL**\n\n🏆 ATP Top 3:\n  1. Carlos Alcaraz 🇪🇸\n  2. Novak Djokovic 🇷🇸 (24 Grand Slams)\n  3. Jannik Sinner 🇮🇹\n\n👑 WTA Top 3:\n  1. Iga Świątek 🇵🇱\n  2. Aryna Sabalenka 🇧🇾\n  3. Coco Gauff 🇺🇸"
        
        # F1
        if 'formula 1' in texto_lower or 'f1' in texto_lower or 'verstappen' in texto_lower:
            return f"🏎️ **FÓRMULA 1**\n\n🏆 {self.datos_deportivos['formula1']['campeon_2024']}\n🔜 {self.datos_deportivos['formula1']['proxima_temporada']}\n⚡ Dominio absoluto de Red Bull Racing"
        
        # ========== ANIMALES ==========
        if 'perro' in texto_lower or 'perros' in texto_lower:
            return f"🐕 **PERROS**\n\n🐶 'El mejor amigo del hombre'\n❤️ Mascotas más populares del mundo\n🏆 Razas populares: Labrador, Golden Retriever, Pastor Alemán\n🧠 Muy inteligentes y leales\n🦴 Descendientes de lobos domesticados\n👃 Olfato 40 veces mejor que humanos"
        
        if 'gato' in texto_lower or 'gatos' in texto_lower:
            return f"🐱 **GATOS**\n\n😺 Mascotas independientes y cariñosas\n🏺 Domesticados hace 10,000 años en Egipto\n🐾 Duermen 12-16 horas al día\n👀 Ven muy bien en la oscuridad\n🎮 Videos de gatos dominan internet\n😻 Razas: Persa, Siamés, Maine Coon"
        
        if 'quien eres' in texto_lower or 'quién eres' in texto_lower or 'que eres' in texto_lower:
            return f"🤖 **SOY CLAUDIA AI v2.0 PROFESSIONAL**\n\n👋 Soy tu asistente inteligente universal\n🧠 Tengo conocimiento sobre miles de temas\n🔍 Puedo buscar en internet lo que no sé\n⚡ Respondo rápido y con información detallada\n\n💡 Mi misión: Ayudarte con cualquier pregunta\n\n¿Qué quieres saber hoy? 🚀"
        
        return None
    
    def procesar_texto(self, texto):
        """Procesamiento principal con IA contextual y multiidioma"""
        texto_lower = texto.lower()
        
        # Detectar y cambiar idioma si se solicita (SIMPLIFICADO)
        if 'english' in texto_lower and len(texto_lower) < 20:
            self.idioma_actual = 'en'
            return "✅ Language changed to English. How can I help you?"
        elif 'français' in texto_lower or 'francais' in texto_lower or 'french' in texto_lower and len(texto_lower) < 20:
            self.idioma_actual = 'fr'
            return "✅ Langue changée en Français. Comment puis-je vous aider?"
        elif 'español' in texto_lower or 'espanol' in texto_lower or 'spanish' in texto_lower and len(texto_lower) < 20:
            self.idioma_actual = 'es'
            return "✅ Idioma cambiado a Español. ¿En qué puedo ayudarte?"
        
        # Guardar en historial
        self.conversacion_historia.append(('usuario', texto))
        
        # Detectar intención
        intencion = self.detectar_intencion(texto)
        
        # Procesar según intención y idioma
        if intencion == 'saludo':
            if self.idioma_actual == 'en':
                respuestas = [
                    "Hello! I'm Claudia, your professional assistant. 🌟 How can I help you?",
                    "Hi! 👋 Ready to help you with information or web searches. What do you need?",
                    "Greetings! ⚡ Ask me anything or request an internet search."
                ]
            elif self.idioma_actual == 'fr':
                respuestas = [
                    "Bonjour! Je suis Claudia, votre assistante professionnelle. 🌟 Comment puis-je vous aider?",
                    "Salut! 👋 Prête à vous aider avec des informations ou des recherches web. Que voulez-vous?",
                    "Salutations! ⚡ Demandez-moi n'importe quoi ou demandez une recherche internet."
                ]
            else:  # español
                respuestas = [
                    "¡Hola! Soy Claudia, tu asistente profesional. 🌟 ¿En qué puedo ayudarte?",
                    "¡Hola! 👋 Lista para ayudarte con información o búsquedas web. ¿Qué necesitas?",
                    "¡Saludos! ⚡ Pregúntame lo que sea o pídeme que busque en internet."
                ]
            respuesta = random.choice(respuestas)
        
        elif intencion == 'despedida':
            if self.idioma_actual == 'en':
                respuestas = [
                    "See you soon! 👋 Come back when you need help.",
                    "Goodbye! 🌟 It was a pleasure helping you!",
                    "Bye! ⚡ I'll be here when you need me."
                ]
            elif self.idioma_actual == 'fr':
                respuestas = [
                    "À bientôt! 👋 Revenez quand vous avez besoin d'aide.",
                    "Au revoir! 🌟 C'était un plaisir de vous aider!",
                    "Salut! ⚡ Je serai là quand vous aurez besoin de moi."
                ]
            else:  # español
                respuestas = [
                    "¡Hasta pronto! 👋 Vuelve cuando necesites ayuda.",
                    "¡Adiós! 🌟 Fue un placer ayudarte!",
                    "¡Chao! ⚡ Aquí estaré cuando me necesites."
                ]
            respuesta = random.choice(respuestas)
        
        elif intencion == 'agradecimiento':
            if self.idioma_actual == 'en':
                respuestas = [
                    "You're welcome! 😊 Always at your service.",
                    "My pleasure to help! ⚡ Ask me anything.",
                    "That's what I'm here for! 🌟 Anything else?"
                ]
            elif self.idioma_actual == 'fr':
                respuestas = [
                    "De rien! 😊 Toujours à votre service.",
                    "Avec plaisir! ⚡ Demandez-moi ce que vous voulez.",
                    "C'est pour ça que je suis là! 🌟 Autre chose?"
                ]
            else:
                respuestas = [
                    "¡De nada! 😊 Siempre a tu servicio.",
                    "¡Un placer ayudarte! ⚡ Pregunta lo que necesites.",
                    "¡Para eso estoy! 🌟 ¿Algo más?"
                ]
            respuesta = random.choice(respuestas)
        
        elif intencion == 'ayuda':
            respuesta = """🤖 **CLAUDIA AI PROFESSIONAL v2.0**

¡Hola! Soy tu asistente inteligente universal. Puedo ayudarte con TODO tipo de información:

🏆 **DEPORTES**
⚽ Fútbol (La Liga, Premier, Champions)
🏀 NBA, 🎾 Tenis, 🏎️ Fórmula 1

💻 **TECNOLOGÍA**
🤖 Inteligencia Artificial
👨‍💻 Programación (Python, JavaScript, etc.)
📱 Empresas tech (Apple, Google, Microsoft)

🔬 **CIENCIA**
🚀 Espacio (NASA, SpaceX, James Webb)
⚕️ Medicina y avances científicos
⚛️ Física y computación cuántica

🎬 **ENTRETENIMIENTO**
🎥 Películas y series
� Música y artistas
🎮 Videojuegos y consolas

🌍 **GEOGRAFÍA E HISTORIA**
🗺️ Países, capitales, datos curiosos
📚 Eventos históricos importantes

📰 **ACTUALIDAD 2025**
🌐 Política, economía, clima

🔍 **BÚSQUEDA EN INTERNET**
Si no tengo la info, la busco en tiempo real.

💬 **EJEMPLOS:**
• "¿Qué es ChatGPT?"
• "Capital de Francia"
• "¿Quién es Taylor Swift?"
• "Información sobre SpaceX"
• "Historia de las guerras mundiales"
• "Busca noticias sobre el clima"

¿Qué quieres saber? ¡Pregúntame lo que sea! 🚀"""
        
        elif intencion == 'busqueda_web':
            # Extraer términos de búsqueda
            terminos = texto_lower
            for palabra in ['busca', 'buscar', 'búsqueda', 'información sobre', 'sobre']:
                terminos = terminos.replace(palabra, '')
            terminos = terminos.strip()
            
            if terminos:
                respuesta = self.buscar_en_internet(terminos)
            else:
                respuesta = "¿Qué quieres que busque? 🔍\n\nEjemplos:\n• 'Busca Messi últimas noticias'\n• 'Información sobre el Mundial 2026'\n• 'Buscar resultados Champions League'"
        
        else:
            # PRIORIDAD 1: Verificar si es una operación matemática (MODO PITÁGORAS)
            respuesta_mate = self.calcular_matematicas(texto)
            if respuesta_mate:
                respuesta = respuesta_mate
            
            # PRIORIDAD 2: Verificar si necesita respuesta inteligente estilo ChatGPT
            elif True:  # Siempre intentar primero respuesta inteligente
                respuesta_inteligente = self.generar_respuesta_inteligente(texto)
                if respuesta_inteligente:
                    respuesta = respuesta_inteligente
                else:
                    # PRIORIDAD 3: Buscar en base de datos local
                    respuesta_local = self.buscar_en_base_datos(texto)
                    if respuesta_local:
                        respuesta = respuesta_local
                    else:
                        # PRIORIDAD 4: Si no hay respuesta local, generar conversacional
                        respuesta = self.respuesta_conversacional_generica(texto)
        
        # Guardar respuesta
        self.conversacion_historia.append(('ia', respuesta))
        
        # Actualizar contexto
        self.contexto_actual = {
            'ultimo_tema': texto[:50],
            'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        }
        
        return respuesta
    
    def obtener_estadisticas(self):
        """Retorna estadísticas de uso"""
        total_mensajes = len(self.conversacion_historia)
        mensajes_usuario = sum(1 for tipo, _ in self.conversacion_historia if tipo == 'usuario')
        
        return {
            'total_mensajes': total_mensajes,
            'mensajes_usuario': mensajes_usuario,
            'mensajes_ia': total_mensajes - mensajes_usuario
        }

# Crear instancia global
ia = IAClaudia()

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/test')
def test():
    return render_template('test.html')

@app.route('/chat', methods=['POST'])
def chat():
    try:
        data = request.get_json()
        mensaje = data.get('mensaje', '')
        
        if mensaje:
            respuesta = ia.procesar_texto(mensaje)
            stats = ia.obtener_estadisticas()
            
            return jsonify({
                'respuesta': respuesta,
                'timestamp': datetime.now().strftime('%H:%M:%S'),
                'stats': stats
            })
        
        return jsonify({'error': 'No se recibió mensaje'}), 400
    except Exception as e:
        print(f"❌ Error en /chat: {e}")
        import traceback
        traceback.print_exc()
        return jsonify({
            'respuesta': f"⚠️ Error al procesar mensaje. Por favor, intenta de nuevo.",
            'error': str(e)
        }), 500

@app.route('/stats', methods=['GET'])
def stats():
    """Endpoint para obtener estadísticas de uso"""
    return jsonify(ia.obtener_estadisticas())

@app.route('/limpiar', methods=['POST'])
def limpiar():
    ia.conversacion_historia = []
    return jsonify({'mensaje': 'Historial limpiado'})

if __name__ == '__main__':
    print("\n" + "="*50)
    print("  🤖 IA Asistente Web - Servidor Iniciado")
    print("="*50)
    print("\n  Abre tu navegador en: http://localhost:5000")
    print("\n  Presiona Ctrl+C para detener el servidor\n")
    app.run(debug=True, host='0.0.0.0', port=5000)
